#!/usr/bin/env python
"""Edit a file in the host nvim instance."""
import os
import sys

from neovim import attach

args = sys.argv[1:]
if not args:
    print "Usage: {} <filename> ...".format(sys.argv[0])
    sys.exit(1)


def fullpath(*args):
    _p = os.path
    return _p.abspath(_p.normpath(_p.expanduser(_p.join(*args))))
    del _p


addr = os.environ.get("NVIM_LISTEN_ADDRESS", None)
if not addr:
    os.execvp('nvim', args)

nvim = attach("socket", path=addr)

nvim.input('<c-\\><c-n>')  # exit terminal mode
nvim.vars['files_to_edit'] = [fullpath(x) for x in args]
for x in args:
    nvim.command('exe "below new ".remove(g:files_to_edit, 0)')
nvim.vars['files_to_edit'] = None
